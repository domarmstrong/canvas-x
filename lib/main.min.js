/*! canvas-x 2014-03-02 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(a){this.c=document.getElementById(a),this.cx=this.c.getContext("2d"),this.events={}}c.prototype={draw:function(){},clear:function(){this.cx.clearRect(0,0,this.c.width,this.c.height)},on:function(a,b){this.off(a,b),this.c.addEventListener(a,b),this.events[a]||(this.events[a]=[]),this.events[a].push(b)},off:function(a,b){if("string"!=typeof a||b){if(!a||!b)throw new Error(".off requires an event name or event name & function pointer to the original function");var c=this.events[a];if(!Array.isArray(c))return;for(var d=0;d<c.length;d++)if(c[d]==b){c.splice(d,1);break}}else{if(c=this.events[a],!Array.isArray(c))return;for(;c.length;)this.c.removeEventListener(a,c.pop())}this.events[a].length||delete this.events[a]}},b.exports=c},{}],2:[function(a,b){function c(){this.init.apply(this,arguments)}function d(){this.init.apply(this,arguments)}var e=a("../util");b.exports={},c.prototype={init:function(a){this.props=a||{},this.state={},this.defaults&&e.extend(this.state,this.defaults),e.extend(this.state,this.props)},"super":function(a,b){var c=Array.prototype.slice.call(arguments,2);a.prototype[b].apply(this,c)},set:function(a){return e.extend(this.state,a),this.screen.draw(),this},get:function(a){return this.state[a]},isPercent:new RegExp(/[0-9]%$/),setBound:function(a){return this.bound=a,this},draw:function(a){this.screen=a,this.props.id&&(this.screen._widgets[this.props.id]=this)},x:function(a){return this.getCoordinate("x",a)},y:function(a){return this.getCoordinate("y",a)},h:function(){return this.getValue("h")},w:function(){return this.getValue("w")},getCoordinate:function(a,b){return void 0==b&&(b=0),this.bound?this.bound[a](this.bound.state[a])+b:b},getValue:function(a){var b=this.get(a);if(void 0===b&&this.bound&&(b=this.bound.getValue(a)),"string"==typeof b){if(this.isPercent.test(b)){var c=this.bound.getValue(a),b=Number(b.split("").slice(0,b.length-1).join(""));return c/100*b}return Number(b)}return b},remove:function(){var a=this.bound.children.indexOf(this);this.bound.children.splice(a,1),this.screen.draw()}},b.exports.Base=c,e.inherit(shape.Rect,d,{init:function(a,b){this.super(shape.Rect,"init",a),this.children=b||[]},draw:function(a,b){this.super(shape.Rect,"draw",a,b),this.drawChildren(a,b)}}),mixins.children(d),b.exports.Bound=d},{"../util":11}],3:[function(a,b){function c(){this.init.apply(this,arguments)}var d=a("../util"),e=(a("./base"),a("./shape")),f=(a("./mixins"),a("../x"));b.exports={},d.inherit(f.ui.Bound,c,{init:function(a,b){this.super(f.ui.Bound,"init",a,b)},defaults:{background:"#222555",color:"#FFFFFF"},draw:function(a,b){var c=this.state;this.children=[new e.Text({text:c.text,fontSize:c.fontSize,fontWeight:c.fontWeight,fontFamily:c.fontFamily,color:c.color}).setBound(this)],this.super(f.ui.Bound,"draw",a,b)},click:function(a){a.propagate=!1,this.props.click&&this.props.click.call(this)}}),b.exports.Button=c},{"../util":11,"../x":12,"./base":2,"./mixins":4,"./shape":5}],4:[function(a,b){function c(){function a(a,b){h=!1,e=b,b.props.dragStart&&b.props.dragStart.call(b,a),b.props.drag&&(f=function(a){b.props.drag.call(b,a)}),b.props.dragStop&&(g=function(a){b.props.dragStop.call(b,a)})}function b(a){g&&(g(a),a.propagate=!1),e=d=f=g=null,c=0}var c=0,d=null,f=null,g=null,h=!1;return{click:function(a){this.props.click&&this.props.click.call(this,a)},mousemove:function(b){this.props.mousemove&&this.props.mousemove(b),f?f(b):1==b.which&&2>c?c++:c>1&&h&&e===this&&a(b,this)},mousedown:function(a){(this.props.dragStart||this.props.drag||this.props.dragStop)&&(h=!0,e=this),this.props.mousedown&&this.props.mousedown.call(this,a)},mouseup:function(a){e&&b(a,this),this.props.mouseup&&this.props.mouseup(this,a)}}}var d=a("../util");b.exports={},b.exports.children=function(a){var b=a.prototype;d.extend(b,{drawChildren:function(a,b){for(var c,d=0;d<this.children.length;d++)c=this.children[d],c.screen=this,c.setBound(this).draw(a,b)}})};var e=null;b.exports.mouseEvents=function(a){var b=a.prototype;d.extend(b,c())}},{"../util":11}],5:[function(a,b){function c(){this.init.apply(this,arguments)}function c(){this.init.apply(this,arguments)}function d(){this.init.apply(this,arguments)}function e(a,b){var c=!0;return a&&b?Object.keys(a).forEach(function(d){a[d]!=b[d]&&(c=!1)}):a!=b&&(c=!1),c}function f(){this.init.apply(this,arguments)}var g=a("../util"),h=a("./base"),i=a("./mixins");b.exports={},g.inherit(h.Base,c,{init:function(a){this.super(h.Base,"init",a)},shape:"rect",draw:function(a,b){if(this.super(h.Base,"draw",a,b),this.state.background){var c=this.state;b.fillStyle=this.state.background,b.fillRect(this.x(c.x),this.y(c.y),this.w(),this.h())}}}),i.mouseEvents(c),b.exports.Rect=c,g.inherit(h.Base,c,{init:function(a){this.super(h.Base,"init",a)},shape:"rect",draw:function(a,b){if(this.super(h.Base,"draw",a,b),this.state.background){var c=this.state;b.fillStyle=this.state.background,b.fillRect(this.x(c.x),this.y(c.y),this.w(),this.h())}}}),i.mouseEvents(c),b.exports.Rect=c,g.inherit(h.Base,d,{init:function(a){this.super(h.Base,"init",a)},defaults:{fontSize:"18px",fontWeight:"bold",fontFamily:"sans-serif",textAlign:"center",textBaseline:"middle",fillStyle:"#000000"},getFont:function(){var a=this.state;return a.fontWeight+" "+a.fontSize+" "+a.fontFamily},draw:function(a,b){this.super(h.Base,"draw",a,b);var c=this.state;if(c.text){{this.bound.state}b.font=this.getFont(),b.textAlign=this.state.textAlign,b.textBaseline=this.state.textBaseline,b.fillStyle=this.state.color,b.fillText(c.text,this.x()+this.w()/2,this.y()+this.h()/2)}}}),b.exports.Text=d,g.inherit(c,f,{init:function(a){this.super(c,"init",a),this.square=null,this.lastSquare=null},defaults:{strokeStyle:"#FF0000",lineWidth:1,size:20},mousemove:function(a){this.props.mousemove&&this.props.mousemove(a),this.getSquare(a.offsetX,a.offsetY)},getSquare:function(a,b){var c=this.state,d=this.getXOffset(),f=this.getYOffset(),g=this.getRows(),h=this.getCols();if(a=a-this.x()-d,b=b-this.y()-f,0>=a||0>=b||a+2*d>=h*c.size||b+2*f>=g*c.size)this.square=null;else{a=Math.floor(a/c.size)*c.size,b=Math.floor(b/c.size)*c.size;var i=a+this.x()+d,j=b+this.y()+f;this.square={x:a,y:b,size:this.state.size,actualX:i,actualY:j}}e(this.square,this.lastSquare)||this.screen.draw(),this.lastSquare=this.square},getRows:function(){return this.h()/this.state.size},getCols:function(){return this.w()/this.state.size},getXOffset:function(){var a=this.getCols();return Math.round(this.w()/a*(a%1)/2)},getYOffset:function(){var a=this.getRows();return Math.round(this.h()/a*(a%1)/2)},draw:function(a,b){this.super(h.Base,"draw",a,b);var c=this.state;b.strokeStyle=c.strokeStyle,b.lineWidth=c.lineWidth;var d=this.getXOffset(),e=this.getYOffset(),f=this.getRows(),g=this.getCols();if(this.square){var i=this.square;b.fillStyle="rgba(255,0,0,0.3)",b.fillRect(this.x(i.x)+d,this.y(i.y)+e,i.size,i.size)}for(var j=0==e?1:0;f>=j;j++)b.beginPath(),b.moveTo(d+this.x(),e+this.y(j*c.size)+.5),b.lineTo(this.x(g*c.size)-d,this.y(j*c.size)+.5+e),b.stroke();for(var j=0==d?1:0;g>=j;j++)b.beginPath(),b.moveTo(d+this.x(j*c.size)+.5,e+this.y()),b.lineTo(d+this.x(j*c.size)+.5,this.y(f*c.size)-e),b.stroke()}}),b.exports.Grid=f},{"../util":11,"./base":2,"./mixins":4}],6:[function(a,b){function c(){this.init.apply(this,arguments)}var d=a("./util");b.exports={},c.prototype={init:function(a){this.props=a,this.state={},this.defaults&&d.extend(this.state,this.defaults),d.extend(this.state,this.props)},"super":function(a,b){var c=Array.prototype.slice.call(arguments,2);a.prototype[b].apply(this,c)},set:function(a){return d.extend(this.state,a),this.screen.draw(),this},get:function(a){return this.state[a]}},b.exports=c},{"./util":11}],7:[function(a,b){function c(){this.canvas=new e("canvas"),this.mouse=new d,this.setupMouse()}var d=a("./mouse"),e=a("./canvas");c.prototype={newGame:function(){this.home()},setupMouse:function(){var a=this.mouse;this.canvas.on("click",function(b){a.handle(b,"click")}),this.canvas.on("mousemove",function(b){a.handle(b,"mousemove")}),this.canvas.on("mousedown",function(b){a.handle(b,"mousedown")}),this.canvas.on("mouseup",function(b){a.handle(b,"mouseup")})},setRoutes:function(a){this.routes=a},go:function(a){this.screen=this.routes[a](),this.mouse.registerScreen(this.screen),this.screen.start(this.canvas)}},b.exports=c},{"./canvas":1,"./mouse":8}],8:[function(a,b){function c(){this.screen,this.event}var d=Math.abs;c.prototype={clickTolerance:4,setEvent:function(a){this.event=a},registerScreen:function(a){this.screen=a},getOffset:function(){return{x:this.event.offsetX,y:this.event.offsetY}},startClick:function(a){this.startx=a.x,this.starty=a.y},isClick:function(a){var b=this.clickTolerance/2;return d(this.startx-a.x)<b&&d(this.starty-a.y)<b},handle:function(a,b){if(this.setEvent(a),a.propagate=!0,"mousedown"===b)this.startClick(a);else if("click"===b&&!this.isClick(a))return;this.screen&&this.bubble(b,this.screen.root.children)},bubble:function(a,b){for(var c=b.length-1;c>=0;c--){var d=b[c];if(d.children&&this.bubble(a,d.children),d[a]&&this.collision(d)){if(!event.propagate)return;d[a](this.event)}}},collision:function(a){return a.shape?this._collision[a.shape].call(this,a):void 0},_collision:{rect:function(a){var b=a,c=b.state,d=this.getOffset();return d.x>b.x(c.x)&&d.x<b.x(c.x)+b.w()&&d.y>b.y(c.y)&&d.y<b.y(c.y)+b.h()?!0:!1}}},b.exports=c},{}],9:[function(a,b){function c(){this.init.apply(this,arguments)}var d=a("./ui");c.prototype={init:function(a){this.controls=a,this._widgets={}},start:function(a){this.canvas=a,this.root=new d.Bound({x:0,y:0,h:a.c.height,w:a.c.width},this.controls),this.draw()},draw:function(){var a=this;a._suppress||(a._suppress=setTimeout(function(){a.root.draw(a,a.canvas.cx),a._suppress=null},Math.floor(12.5)))},getWidget:function(a){return this._widgets[a]}},b.exports=c},{"./ui":10}],10:[function(a,b){var c=a("./util");b.exports={},reexport=c.reexport(b),reexport(a("./canvas/base")),reexport(a("./canvas/controls")),reexport(a("./canvas/shape"))},{"./canvas/base":2,"./canvas/controls":3,"./canvas/shape":5,"./util":11}],11:[function(a,b){b.exports.inherit=function(a,b,c){var d=Object.create(a.prototype);Object.keys(c).forEach(function(a){d[a]=c[a]}),d.constructor=b,b.prototype=d},b.exports.extend=function(a,b){return Object.keys(b).forEach(function(c){void 0!==b[c]&&(a[c]=b[c])}),a},b.exports.reexport=function(a){return function(b){if("function"==typeof b){if(!b.name)throw console.error(b),new Error("Cannot re-export module as it is an annonymouse function");a.exports[name]=b}else Object.keys(b).forEach(function(c){a.exports[c]=b[c]})}}},{}],12:[function(a,b){b.exports={Game:a("./game"),Class:a("./class"),Screen:a("./screen"),ui:a("./ui"),util:a("./util")}},{"./class":6,"./game":7,"./screen":9,"./ui":10,"./util":11}]},{},[12]);